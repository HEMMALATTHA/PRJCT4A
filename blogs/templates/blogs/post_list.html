{% extends "base.html" %}
{% block title %}Posts{% endblock %}
{% block content %}
<h1>Posts</h1>

<form method="get">
  <input type="text" name="q" placeholder="Search..." value="{{ request.GET.q }}">
  <select name="category">
    <option value="">-- All categories --</option>
    {% for c in categories %}
      <option value="{{ c.slug }}" {% if active_cat == c.slug %}selected{% endif %}>{{ c.name }}</option>
    {% endfor %}
  </select>
  <button type="submit">Search</button>
</form>

{% for post in posts %}
  <article style="margin: 1rem 0;">
    <h2><a href="{% url 'post-detail' post.slug %}">{{ post.title }}</a></h2>
    <small>by {{ post.author.username }} Â· {{ post.created_at|date:"Y-m-d H:i" }}</small>
    <div>
      {% for c in post.categories.all %}<span>#{{ c.name }}</span>{% empty %}{% endfor %}
    </div>
    {% if post.image %}<img src="{{ post.image.url }}" style="max-width:250px">{% endif %}
    <p>{{ post.content|truncatewords:40 }}</p>
  </article>
{% empty %}
  <p>No posts yet.</p>
{% endfor %}

{% if is_paginated %}
  <div>
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}&q={{ request.GET.q }}&category={{ request.GET.category }}">Previous</a>
    {% endif %}
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}&q={{ request.GET.q }}&category={{ request.GET.category }}">Next</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
